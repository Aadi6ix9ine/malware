from flask import Flask, render_template, request, jsonify
from flask_cors import CORS, cross_origin
import pickle
import os
import time
import pyfiglet
import subprocess



app = Flask(__name__)
def run_URL(Content):
    

    command = f'python Extract/urlnew.py --url {Content}'
    result = subprocess.check_output(command, shell=True).decode('utf-8').strip()
    print(result)
    return result

def run_PE(file):
    command = f'python Extract/PE_main.py {file}'
    result = subprocess.check_output(command, shell=True).decode('utf-8').strip()
    return result

@app.route('/', methods=['GET'])
@cross_origin()
def homepage():
    return render_template('index.html')


@app.route('/predict', methods=['POST', 'GET'])
@cross_origin()
def Prediction():
    if request.method == 'POST':
        try:
            selected_option = request.form['Select']
            content = request.form['content']

            if selected_option == "URL_scanner":
                result = run_URL(content) 
                if result == 'good':
                    prediction = f"The provided URL is malware free!!!!!"
                                # image = 'URL image URL'
                elif result == 'bad':
                    prediction = f"The provided URL contains malware be safe!!!!!"

            elif selected_option == "File_scanner":
                result = run_URL(content) 
                if result == 'good':
                    prediction = f"The provided File is malware free!!!!!"
                                # image = 'URL image URL'
                elif result == 'bad':
                    prediction = f"The provided File contains malware be safe!!!!!"                
                # image = 'File image URL'

            return render_template('results.html', prediction=prediction)

        except Exception as e:
            print('the exception msg is: ', e)
            return 'Something went wrong'
    else:
        return render_template('index.html')


if __name__ == '__main__':
    app.run(debug=True)